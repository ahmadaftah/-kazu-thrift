{% extends "base.html" %}

{% block content %}
<div class="content-container">
    <div style="margin-bottom: 30px;">
        <h1>üìà Laporan Toko</h1>
        <p>Pantau performa penjualan dan stok barang Anda di sini.</p>
    </div>

    <!-- Summary Cards (Optional but good for UX) -->
    <div style="display: flex; gap: 20px; margin-bottom: 30px;">
        <div class="glass" style="flex: 1; padding: 20px; text-align: center;">
            <h4 style="opacity: 0.8; margin-bottom: 10px;">Total Penjualan</h4>
            <h2 style="font-size: 28px;">{{ sales|length }} Transaksi</h2>
        </div>
        <div class="glass" style="flex: 1; padding: 20px; text-align: center; border-color: rgba(245, 87, 108, 0.5);">
            <h4 style="opacity: 0.8; margin-bottom: 10px;">Barang Sold Out</h4>
            <h2 style="font-size: 28px; color: #ff7675;">{{ sold_out|length }} Item</h2>
        </div>
    </div>

    <!-- Section: Sales History -->
    <div style="margin-bottom: 40px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h3>üìä Riwayat Pendapatan</h3>
            <button class="btn" style="width: auto; padding: 8px 15px; font-size: 14px;" onclick="window.print()">üñ®Ô∏è
                Cetak Laporan</button>
        </div>
        <div class="glass" style="overflow: hidden;">
            <table>
                <thead>
                    <tr>
                        <th>Tanggal</th>
                        <th>Nama Barang</th>
                        <th>Kategori</th>
                        <th>Qty</th>
                        <th>Total Harga (Rp)</th>
                    </tr>
                </thead>
                <tbody>
                    {% for sale in sales %}
                    <tr>
                        <td>{{ sale.sale_date.strftime('%d %b %Y, %H:%M') }}</td>
                        <td>{{ sale.product_name }}</td>
                        <td>{{ sale.category }}</td>
                        <td>{{ sale.quantity }}</td>
                        <td>{{ "{:,.0f}".format(sale.total_price) }}</td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="5" style="text-align: center; opacity: 0.6; padding: 40px;">Belum ada riwayat
                            penjualan.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Section: Sold Out Items -->
    <div>
        <h3 style="margin-bottom: 20px; color: #ff7675;">üö´ Barang Habis (Sold Out)</h3>
        <div class="glass" style="overflow: hidden;">
            <table>
                <thead>
                    <tr>
                        <th>Foto</th>
                        <th>Nama Barang</th>
                        <th>Kategori</th>
                        <th>Harga Terakhir (Rp)</th>
                        <th>Aksi</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in sold_out %}
                    <tr>
                        <td>
                            <img src="{% if item.image_url and item.image_url.startswith('http') %}{{ item.image_url }}{% else %}{{ url_for('static', filename='img/products/' + (item.image_url or 'default-product.png')) }}{% endif %}"
                                alt="{{ item.name }}"
                                style="width: 40px; height: 40px; object-fit: cover; border-radius: 8px; border: 2px solid rgba(255,255,255,0.2);"
                                onerror="this.onerror=null; this.src='https://placehold.co/400x400?text=No+Image';">
                        </td>
                        <td>{{ item.name }}</td>
                        <td>{{ item.category }}</td>
                        <td>{{ "{:,.0f}".format(item.price) }}</td>
                        <td>
                            <a href="{{ url_for('inventory') }}" class="btn"
                                style="padding: 5px 10px; font-size: 12px; width: auto;">üì¶ Restock</a>
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="5" style="text-align: center; opacity: 0.6; padding: 40px;">Tidak ada barang yang
                            habis. üéâ</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Section: Activity Logs (Admin Only) -->
    {% if role == 'Admin' %}
    <div style="margin-top: 50px;">
        <h3 style="margin-bottom: 20px; color: #a29bfe;">üìú Log Aktivitas Sistem</h3>
        <div class="glass" style="overflow: hidden;">
            <table style="font-size: 14px;">
                <thead>
                    <tr>
                        <th>Waktu</th>
                        <th>User</th>
                        <th>Aksi</th>
                        <th>Item</th>
                    </tr>
                </thead>
                <tbody>
                    {% for log in logs %}
                    <tr>
                        <td style="opacity: 0.8;">{{ log.timestamp.strftime('%d/%m/%y, %H:%M') }}</td>
                        <td><strong>{{ log.username }}</strong></td>
                        <td>{{ log.action }}</td>
                        <td>{{ log.item_name }}</td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="4" style="text-align: center; opacity: 0.6; padding: 20px;">Belum ada aktivitas
                            tercatat.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}